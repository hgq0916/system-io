#### RPC框架

理解：就像调用本地方法一样去调用远程方法，面向java中就是所谓的面向interface开发

服务端和客户端定义统一的interface，在服务端有interface的实现类，客户端通过动态代理生成interface的代理类，当调用代理类的方法时，实际上去请求远程的服务端，服务端负责调用真正的方法并把结果返回给客户端。

涉及到的知识点：

1.来回通信，连接数量，拆包

2.动态代理呀，序列化，协议封装

3.连接池

思路：

1.定义接口方法

2.创建一个接口的代理对象，调用代理对象的方法

3.编写代理对象中的handler

3.1获取调用接口名称，方法名，参数列表，参数集合

3.2使用上述字段封装一个content对象

3.3封装请求头：包括标志位、RequestId，content长度信息；

RequestId用来标识一次请求，当服务端返回数据时会带着RequestId，通过RequestId找到对应的请求线程

3.4将请求头和请求体封装到ByteBuf中

3.5获取一个客户端连接，这里通过一个客户端连接工厂类获取

3.6获取到客户端连接后，调用发送方法将数据写到服务端

3.7 阻塞该线程，使用CountDownLanuch的await等待，并把RequestId和回调函数存放到一个静态的hash中，

回调函数调用CountDownLanuch的countDown对线程解除阻塞

3.8 封装一个管理RequestId的类，提供静态方法：
  添加RequestId和Runnable接口的实现类
  通过RequestId执行回调函数的方法，在方法中，需要从hash中移除RequestId；
3.9 后续处理

4.编写客户端工厂类和连接池类

4.1 编写客户端的连接池类，连接池中有个客户端连接数组，以及一个附加锁数组，

编写构造方法，通过入参来初始化客户端连接数组及附加锁数组；

4.2 编写工厂类，对一个ip和端口来说可能有多个连接，因此使用INetSocketAddress作为key，连接池对象作为value存放每个ip和端口对应的连接池；
工厂类提供获取客户端的方法，当客户端连接不存在时初始化客户端连接，并设置handler
5.编写客户端响应处理类，在处理类中获取服务端发送的字节数组，解析字节数组，获取RequestId，调用RequestId对应的回调函数。
6.编写服务端，服务端负责监听客户端的请求
7.编写客户端请求处理类，处理客户端发送的数据，从接收的字节数组中解析服务名称，方法名，参数列表，执行方法，将方法的返回结果回写给客户端
8.扩展：客户端如何发现服务端？借助注册中心，服务端向注册中心注册，客户端从注册中心获取服务端的连接地址信息，客户端通过连接地址信息请求服务端


